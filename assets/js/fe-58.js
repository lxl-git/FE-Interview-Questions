(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{1013:function(t,s,a){"use strict";a.r(s);var n=a(52),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_1-跨标签页通讯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-跨标签页通讯"}},[t._v("#")]),t._v(" 1 跨标签页通讯")]),t._v(" "),a("blockquote",[a("p",[t._v("不同标签页间的通讯，本质原理就是去运用一些可以 共享的中间介质，因此比较常用的有以下方法:")])]),t._v(" "),a("ul",[a("li",[t._v("通过父页面"),a("code",[t._v("window.open()")]),t._v("和子页面"),a("code",[t._v("postMessage")]),t._v(" "),a("ul",[a("li",[t._v("异步下，通过 "),a("code",[t._v("window.open('about: blank')")]),t._v(" 和 "),a("code",[t._v("tab.location.href = '*'")])])])]),t._v(" "),a("li",[t._v("设置同域下共享的"),a("code",[t._v("localStorage")]),t._v("与监听"),a("code",[t._v("window.onstorage")]),t._v(" "),a("ul",[a("li",[t._v("重复写入相同的值无法触发")]),t._v(" "),a("li",[t._v("会受到浏览器隐身模式等的限制")])])]),t._v(" "),a("li",[t._v("设置共享"),a("code",[t._v("cookie")]),t._v("与不断轮询脏检查("),a("code",[t._v("setInterval")]),t._v(")")]),t._v(" "),a("li",[t._v("借助服务端或者中间层实现")])]),t._v(" "),a("h2",{attrs:{id:"_2-浏览器架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-浏览器架构"}},[t._v("#")]),t._v(" 2 浏览器架构")]),t._v(" "),a("ul",[a("li",[t._v("用户界面")]),t._v(" "),a("li",[t._v("主进程")]),t._v(" "),a("li",[t._v("内核\n"),a("ul",[a("li",[t._v("渲染引擎")]),t._v(" "),a("li",[a("code",[t._v("JS")]),t._v(" 引擎\n"),a("ul",[a("li",[t._v("执行栈")])])])])]),t._v(" "),a("li",[t._v("事件触发线程\n"),a("ul",[a("li",[t._v("消息队列\n"),a("ul",[a("li",[t._v("微任务")]),t._v(" "),a("li",[t._v("宏任务")])])])])]),t._v(" "),a("li",[t._v("网络异步线程")]),t._v(" "),a("li",[t._v("定时器线程")])]),t._v(" "),a("h2",{attrs:{id:"_3-渲染机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-渲染机制"}},[t._v("#")]),t._v(" 3 渲染机制")]),t._v(" "),a("h3",{attrs:{id:"_3-1-浏览器的渲染机制一般分为以下几个步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-浏览器的渲染机制一般分为以下几个步骤"}},[t._v("#")]),t._v(" 3.1 浏览器的渲染机制一般分为以下几个步骤")]),t._v(" "),a("ul",[a("li",[t._v("处理 "),a("code",[t._v("HTML")]),t._v(" 并构建 "),a("code",[t._v("DOM")]),t._v(" 树。")]),t._v(" "),a("li",[t._v("处理 "),a("code",[t._v("CSS")]),t._v(" 构建 "),a("code",[t._v("CSSOM")]),t._v(" 树。")]),t._v(" "),a("li",[t._v("将 "),a("code",[t._v("DOM")]),t._v(" 与 "),a("code",[t._v("CSSOM")]),t._v(" 合并成一个渲染树。")]),t._v(" "),a("li",[t._v("根据渲染树来布局，计算每个节点的位置。")]),t._v(" "),a("li",[t._v("调用 "),a("code",[t._v("GPU")]),t._v(" 绘制，合成图层，显示在屏幕上")])]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://s.poetries.top/gitee/2020/09/98.png",loading:"lazy"}})]),t._v(" "),a("ul",[a("li",[t._v("在构建 CSSOM 树时，会阻塞渲染，直至 CSSOM 树构建完成。并且构建 CSSOM 树是一个十分消耗性能的过程，所以应该尽量保证层级扁平，减少过度层叠，越是具体的 CSS 选择器，执行速度越慢。")]),t._v(" "),a("li",[t._v("css 是阻塞渲染的资源。需要将它尽早、尽快地下载到客户端，以便缩短首次渲染的时间")]),t._v(" "),a("li",[t._v("当 HTML 解析到 script 标签时，会暂停构建 DOM，完成后才会从暂停的地方重新开始。也就是说，如果你想首屏渲染的越快，就越不应该在首屏就加载 JS 文件。并且 CSS 也会影响 JS 的执行，只有当解析完样式表才会执行 JS，所以也可以认为这种情况下，CSS 也会暂停构建 DOM")])]),t._v(" "),a("h3",{attrs:{id:"_3-2-图层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-图层"}},[t._v("#")]),t._v(" 3.2 图层")]),t._v(" "),a("blockquote",[a("p",[t._v("一般来说，可以把普通文档流看成一个图层。特定的属性可以生成一个新的图层。不同的图层渲染互不影响，所以对于某些频繁需要渲染的建议单独生成一个新图层，提高性能。但也不能生成过多的图层，会引起反作用")])]),t._v(" "),a("ul",[a("li",[t._v("通过以下几个常用属性可以生成新图层\n"),a("ul",[a("li",[a("code",[t._v("3D")]),t._v("变换："),a("code",[t._v("translate3d")]),t._v("、"),a("code",[t._v("translateZ")])]),t._v(" "),a("li",[a("code",[t._v("will-change")])]),t._v(" "),a("li",[a("code",[t._v("video")]),t._v("、"),a("code",[t._v("iframe")]),t._v(" 标签")]),t._v(" "),a("li",[t._v("通过动画实现的 "),a("code",[t._v("opacity")]),t._v(" 动画转换")]),t._v(" "),a("li",[a("code",[t._v("position: fixed")])])])])]),t._v(" "),a("h3",{attrs:{id:"_3-3-重绘与回流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-重绘与回流"}},[t._v("#")]),t._v(" 3.3 重绘与回流")]),t._v(" "),a("blockquote",[a("p",[t._v("当元素的样式发生变化时，浏览器需要触发更新，重新绘制元素。这个过程中，有两种类型的操作，即重绘与回流。")])]),t._v(" "),a("blockquote",[a("ul",[a("li",[t._v("重绘(repaint): 当元素样式的改变不影响布局时，浏览器将使用重绘对元素进行更新，此时由于只需要UI层面的重新像素绘制，因此 损耗较少")]),t._v(" "),a("li",[t._v("回流(reflow): 当元素的尺寸、结构或触发某些属性时，浏览器会重新渲染页面，称为回流。此时，浏览器需要重新经过计算，计算后还需要重新页面布局，因此是较重的操作。会触发回流的操作:")])])]),t._v(" "),a("ul",[a("li",[t._v("页面初次渲染")]),t._v(" "),a("li",[t._v("浏览器窗口大小改变")]),t._v(" "),a("li",[t._v("元素尺寸、位置、内容发生改变")]),t._v(" "),a("li",[t._v("元素字体大小变化")]),t._v(" "),a("li",[t._v("添加或者删除可见的 "),a("code",[t._v("dom")]),t._v(" 元素")]),t._v(" "),a("li",[t._v("激活 "),a("code",[t._v("CSS")]),t._v(" 伪类（例如："),a("code",[t._v(":hover")]),t._v("）")]),t._v(" "),a("li",[t._v("查询某些属性或调用某些方法\n"),a("ul",[a("li",[a("code",[t._v("clientWidth、clientHeight、clientTop、clientLeft")])]),t._v(" "),a("li",[a("code",[t._v("offsetWidth、offsetHeight、offsetTop、offsetLeft")])]),t._v(" "),a("li",[a("code",[t._v("scrollWidth、scrollHeight、scrollTop、scrollLeft")])]),t._v(" "),a("li",[a("code",[t._v("getComputedStyle()")])]),t._v(" "),a("li",[a("code",[t._v("getBoundingClientRect()")])]),t._v(" "),a("li",[a("code",[t._v("scrollTo()")])])])])]),t._v(" "),a("blockquote",[a("p",[t._v("回流必定触发重绘，重绘不一定触发回流。重绘的开销较小，回流的代价较高。")])]),t._v(" "),a("p",[a("strong",[t._v("回流的优化")])]),t._v(" "),a("blockquote",[a("p",[t._v("对树的局部甚至全局重新生成是非常耗性能的，所以要避免频繁触发回流")])]),t._v(" "),a("ul",[a("li",[t._v("现代浏览器已经帮我们做了优化，采用队列存储多次的回流操作，然后批量执行，但获取布局信息例外，因为要获取到实时的数值，浏览器就必须要清空队列，立即执行回流。")]),t._v(" "),a("li",[t._v("编码上，避免连续多次修改，可通过合并修改，一次触发")]),t._v(" "),a("li",[t._v("减少"),a("code",[t._v("dom")]),t._v("的增删次数，可使用 字符串 或者 "),a("code",[t._v("documentFragment")]),t._v(" 一次性插入")]),t._v(" "),a("li",[t._v("对于大量不同的 "),a("code",[t._v("dom")]),t._v(" 修改，可以先将其脱离文档流，比如使用绝对定位，或者 "),a("code",[t._v("display:none")]),t._v("，在文档流外修改完成后再放回文档里中")]),t._v(" "),a("li",[t._v("将动画效果应用到"),a("code",[t._v("position")]),t._v("属性为"),a("code",[t._v("absolute")]),t._v("或"),a("code",[t._v("fixed")]),t._v("的元素上")]),t._v(" "),a("li",[t._v("动画实现的速度的选择，动画速度越快，回流次数越多，也可以选择使用 "),a("code",[t._v("requestAnimationFrame")])]),t._v(" "),a("li",[t._v("通过节流和防抖控制触发频率")]),t._v(" "),a("li",[a("code",[t._v("css3")]),t._v(" 硬件加速，"),a("code",[t._v("transform")]),t._v("、"),a("code",[t._v("opacity")]),t._v("、"),a("code",[t._v("filters")]),t._v("，开启后，会新建渲染层")])]),t._v(" "),a("p",[t._v("另外，可以借助 "),a("code",[t._v("DevTools Performance")]),t._v(" 面板来查看产生回流重绘任务占用主线程的情况和调用代码")]),t._v(" "),a("p",[a("strong",[t._v("开启GPU加速的方法")])]),t._v(" "),a("blockquote",[a("p",[t._v("开启后，会将 dom元素提升为独立的渲染层，它的变化不会再影响文档流中的布局。")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("transform: translateZ(0)")])]),t._v(" "),a("li",[a("code",[t._v("opacity")])]),t._v(" "),a("li",[a("code",[t._v("filters")])]),t._v(" "),a("li",[a("code",[t._v("Will-change")])])]),t._v(" "),a("p",[a("strong",[t._v("很多人不知道的是，重绘和回流其实和 "),a("code",[t._v("Event loop")]),t._v(" 有关")])]),t._v(" "),a("ul",[a("li",[t._v("当 "),a("code",[t._v("Event loop")]),t._v(" 执行完 "),a("code",[t._v("Microtasks")]),t._v(" 后，会判断 "),a("code",[t._v("document")]),t._v(" 是否需要更新。因为浏览器是 "),a("code",[t._v("60Hz")]),t._v("的刷新率，每 "),a("code",[t._v("16ms")]),t._v("才会更新一次。")]),t._v(" "),a("li",[t._v("然后判断是否有 "),a("code",[t._v("resize")]),t._v(" 或者 "),a("code",[t._v("scroll")]),t._v(" ，有的话会去触发事件，所以 "),a("code",[t._v("resize")]),t._v(" 和 "),a("code",[t._v("scroll")]),t._v(" 事件也是至少 "),a("code",[t._v("16ms")]),t._v(" 才会触发一次，并且自带节流功能。")]),t._v(" "),a("li",[t._v("判断是否触发了"),a("code",[t._v("media query")])]),t._v(" "),a("li",[t._v("更新动画并且发送事件")]),t._v(" "),a("li",[t._v("判断是否有全屏操作事件")]),t._v(" "),a("li",[t._v("执行 "),a("code",[t._v("requestAnimationFrame")]),t._v(" 回调")]),t._v(" "),a("li",[t._v("执行 "),a("code",[t._v("IntersectionObserver")]),t._v(" 回调，该方法用于判断元素是否可见，可以用于懒加载上，但是兼容性不好")]),t._v(" "),a("li",[t._v("更新界面")]),t._v(" "),a("li",[t._v("以上就是一帧中可能会做的事情。如果在一帧中有空闲时间，就会去执行 "),a("code",[t._v("requestIdleCallback")]),t._v(" 回调")])]),t._v(" "),a("h3",{attrs:{id:"_3-4-javascript-会阻塞-dom-生成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-javascript-会阻塞-dom-生成"}},[t._v("#")]),t._v(" 3.4 JavaScript 会阻塞 DOM 生成")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("JavaScript")]),t._v(" 会阻塞 "),a("code",[t._v("DOM")]),t._v("生成，而样式文件又会阻塞 "),a("code",[t._v("JavaScript")]),t._v(" 的执行，所以在实际的工程中需要重点关注 "),a("code",[t._v("JavaScript")]),t._v(" 文件和样式表文件，使用不当会影响到页面性能的")])]),t._v(" "),a("blockquote",[a("p",[t._v("当渲染进程接收 HTML 文件字节流时，会先开启一个预解析线程，如果遇到 JavaScript 文件或者 CSS 文件，那么预解析线程会提前下载这些数据")])]),t._v(" "),a("ul",[a("li",[t._v("如果代码里引用了外部的 CSS 文件，那么在执行 JavaScript 之前，还需要等待外部的 CSS 文件下载完成，并解析生成 CSSOM 对象之后，才能执行 JavaScript 脚本。")]),t._v(" "),a("li",[t._v("而 JavaScript 引擎在解析 JavaScript 之前，是不知道 JavaScript 是否操纵了 CSSOM 的，所以渲染引擎在遇到 JavaScript 脚本时，不管该脚本是否操纵了 CSSOM，都会执行 CSS 文件下载，解析操作，再执行 JavaScript 脚本。")]),t._v(" "),a("li",[t._v("不管 CSS 文件和 JavaScript 文件谁先到达，都要先等到 CSS 文件下载完成并生成 CSSOM，然后再执行 JavaScript 脚本，最后再继续构建 DOM，构建布局树，绘制页面")])]),t._v(" "),a("h3",{attrs:{id:"_3-5-缩短白屏时长-可以有以下策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-缩短白屏时长-可以有以下策略"}},[t._v("#")]),t._v(" 3.5 缩短白屏时长，可以有以下策略")]),t._v(" "),a("ul",[a("li",[t._v("通过内联 JavaScript、内联 CSS 来移除这两种类型的文件下载，这样获取到 HTML 文件之后就可以直接开始渲染流程了。")]),t._v(" "),a("li",[t._v("但并不是所有的场合都适合内联，那么还可以尽量减少文件大小，比如通过 webpack 等工具移除一些不必要的注释，并压缩 JavaScript 文件。")]),t._v(" "),a("li",[t._v("还可以将一些不需要在解析 HTML 阶段使用的 JavaScript 标记上 "),a("code",[t._v("sync")]),t._v(" 或者 "),a("code",[t._v("defer")])]),t._v(" "),a("li",[t._v("对于大的 CSS 文件，可以通过媒体查询属性，将其拆分为多个不同用途的 CSS 文件，这样只有在特定的场景下才会加载特定的 CSS 文件。")])]),t._v(" "),a("h2",{attrs:{id:"_4-跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-跨域"}},[t._v("#")]),t._v(" 4 跨域")]),t._v(" "),a("blockquote",[a("p",[t._v("因为浏览器出于安全考虑，有同源策略。也就是说，如果"),a("code",[t._v("协议")]),t._v("、"),a("code",[t._v("域名")]),t._v("、"),a("code",[t._v("端口")]),t._v("有一个不同就是跨域，"),a("code",[t._v("Ajax")]),t._v(" 请求会失败。")])]),t._v(" "),a("p",[t._v("我们可以通过以下几种常用方法解决跨域的问题")]),t._v(" "),a("h3",{attrs:{id:"_4-1-jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-jsonp"}},[t._v("#")]),t._v(" 4.1 JSONP")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("JSONP")]),t._v(" 的原理很简单，就是利用 "),a("code",[t._v("<script>")]),t._v("标签没有跨域限制的漏洞。通过 "),a("code",[t._v("<script>")]),t._v("标签指向一个需要访问的地址并提供一个回调函数来接收数据")])]),t._v(" "),a("p",[a("strong",[t._v("涉及到的端")])]),t._v(" "),a("p",[a("code",[t._v("JSONP")]),t._v(" 需要服务端和前端配合实现。")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://domain/api?param1=a&param2=b&callback=jsonp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("jsonp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("    \n")])])]),a("blockquote",[a("p",[a("code",[t._v("JSONP")]),t._v(" 使用简单且兼容性不错，但是"),a("strong",[t._v("只限于 "),a("code",[t._v("get")]),t._v(" 请求")])])]),t._v(" "),a("p",[a("strong",[t._v("具体实现方式")])]),t._v(" "),a("ul",[a("li",[t._v("在开发中可能会遇到多个 "),a("code",[t._v("JSONP")]),t._v(" 请求的回调函数名是相同的，这时候就需要自己封装一个 "),a("code",[t._v("JSONP")]),t._v("，以下是简单实现")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("jsonp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" jsonpCallback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" success")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" script "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"script"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("async "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text/javascript"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("jsonpCallback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    success "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("success")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("jsonp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://xxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"callback"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"_4-2-cors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-cors"}},[t._v("#")]),t._v(" 4.2 CORS")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("CORS")]),t._v(" （Cross-Origin Resource Sharing，跨域资源共享） 是目前最为广泛的解决跨域问题的方案。方案依赖服务端/后端在响应头中添加 Access-Control-Allow-* 头，告知浏览器端通过此请求")])]),t._v(" "),a("p",[a("strong",[t._v("涉及到的端")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("CORS")]),t._v(" 只需要服务端/后端支持即可，不涉及前端改动")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("CORS")]),t._v("需要浏览器和后端同时支持。"),a("code",[t._v("IE 8")]),t._v(" 和 "),a("code",[t._v("9")]),t._v(" 需要通过 "),a("code",[t._v("XDomainRequest")]),t._v(" 来实现。")]),t._v(" "),a("li",[t._v("浏览器会自动进行 "),a("code",[t._v("CORS")]),t._v(" 通信，实现"),a("code",[t._v("CORS")]),t._v("通信的关键是后端。只要后端实现了 "),a("code",[t._v("CORS")]),t._v("，就实现了跨域。")]),t._v(" "),a("li",[t._v("服务端设置 "),a("code",[t._v("Access-Control-Allow-Origin")]),t._v(" 就可以开启 "),a("code",[t._v("CORS")]),t._v("。 该属性表示哪些域名可以访问资源，如果设置通配符则表示所有网站都可以访问资源。")])]),t._v(" "),a("p",[a("code",[t._v("CORS")]),t._v(" 实现起来非常方便，只需要增加一些 "),a("code",[t._v("HTTP")]),t._v(" 头，让服务器能声明允许的访问来源")]),t._v(" "),a("p",[t._v("只要后端实现了 "),a("code",[t._v("CORS")]),t._v("，就实现了跨域")]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://s.poetries.top/uploads/2022/08/b0f21ec685ae839b.png",loading:"lazy"}})]),t._v(" "),a("p",[t._v("以 "),a("code",[t._v("koa")]),t._v("框架举例")]),t._v(" "),a("p",[t._v("添加中间件，直接设置"),a("code",[t._v("Access-Control-Allow-Origin")]),t._v("请求头")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Headers'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type, Content-Length, Authorization, Accept, X-Requested-With , yourHeaderFeild'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Methods'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PUT, POST, GET, DELETE, OPTIONS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OPTIONS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("strong",[t._v("具体实现方式")])]),t._v(" "),a("p",[a("code",[t._v("CORS")]),t._v(" 将请求分为简单请求（Simple Requests）和需预检请求（Preflighted requests），不同场景有不同的行为")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("简单请求")]),t._v("：不会触发预检请求的称为简单请求。当请求满足以下条件时就是一个简单请求：\n"),a("ul",[a("li",[t._v("请求方法："),a("code",[t._v("GET")]),t._v("、"),a("code",[t._v("HEAD")]),t._v("、"),a("code",[t._v("POST")]),t._v("。")]),t._v(" "),a("li",[t._v("请求头："),a("code",[t._v("Accept")]),t._v("、"),a("code",[t._v("Accept-Language")]),t._v("、"),a("code",[t._v("Content-Language")]),t._v("、"),a("code",[t._v("Content-Type")]),t._v("。\n"),a("ul",[a("li",[a("code",[t._v("Content-Type")]),t._v(" 仅支持："),a("code",[t._v("application/x-www-form-urlencoded")]),t._v("、"),a("code",[t._v("multipart/form-data")]),t._v("、"),a("code",[t._v("text/plain")])])])])])]),t._v(" "),a("li",[a("strong",[t._v("需预检请求")]),t._v("：当一个请求不满足以上简单请求的条件时，浏览器会自动向服务端发送一个 "),a("code",[t._v("OPTIONS")]),t._v(" 请求，通过服务端返回的"),a("code",[t._v("Access-Control-Allow-*")]),t._v(" 判定请求是否被允许")])]),t._v(" "),a("p",[a("code",[t._v("CORS")]),t._v(" 引入了以下几个以 "),a("code",[t._v("Access-Control-Allow-*")]),t._v(" 开头：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Access-Control-Allow-Origin")]),t._v(" 表示允许的来源")]),t._v(" "),a("li",[a("code",[t._v("Access-Control-Allow-Methods")]),t._v(" 表示允许的请求方法")]),t._v(" "),a("li",[a("code",[t._v("Access-Control-Allow-Headers")]),t._v(" 表示允许的请求头")]),t._v(" "),a("li",[a("code",[t._v("Access-Control-Allow-Credentials")]),t._v(" 表示允许携带认证信息")])]),t._v(" "),a("p",[t._v("当请求符合响应头的这些条件时，浏览器才会发送并响应正式的请求")]),t._v(" "),a("h3",{attrs:{id:"_4-3-nginx反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-nginx反向代理"}},[t._v("#")]),t._v(" 4.3 nginx反向代理")]),t._v(" "),a("p",[t._v("反向代理只需要服务端/后端支持，几乎不涉及前端改动，只用切换接口即可")]),t._v(" "),a("p",[a("strong",[t._v("nginx 配置跨域，可以为全局配置和单个代理配置(两者不能同时配置)")])]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("全局配置")]),t._v("，在"),a("code",[t._v("nginx.conf")]),t._v("文件中的 "),a("code",[t._v("http")]),t._v(" 节点加入跨域信息")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("http "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 跨域配置")]),t._v("\n  add_header "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$http_origin'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  add_header "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Credentials'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  add_header "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Methods'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PUT,POST,GET,DELETE,OPTIONS'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  add_header "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Headers'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type,Content-Length,Authorization,Accept,X-Requested-With'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("strong",[t._v("局部配置")]),t._v("（单个代理配置跨域）, 在路径匹配符中加入跨域信息")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name  server_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  charset utf-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里配置单个代理跨域，跨域配置")]),t._v("\n    add_header "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$http_origin'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    add_header "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Credentials'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    add_header "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Methods'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PUT,POST,GET,DELETE,OPTIONS'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    add_header "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Headers'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type,Content-Length,Authorization,Accept,X-Requested-With'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置代理 代理到本机服务端口")]),t._v("\n    proxy_pass http://127.0.0.1:9000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_redirect   off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$server_port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_4-4-node-中间层接口转发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-node-中间层接口转发"}},[t._v("#")]),t._v(" 4.4 Node 中间层接口转发")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" router "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-router'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" rp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'request-promise'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过node中间层转发实现接口跨域")]),t._v("\nrouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/github'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("category "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'trending'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("lang "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'javascript'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("limit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("period"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body \n  lang "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lang "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'javascript'")]),t._v("\n  limit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" limit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n  offset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" offset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  period "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" period "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'week'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" res "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("method")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 跨域的接口")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("uri")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("https://e.juejin.cn/resources/github")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("body")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      category"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      lang"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      limit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      period\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("json")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  \n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" res\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" router\n")])])]),a("h3",{attrs:{id:"_4-5-proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-proxy"}},[t._v("#")]),t._v(" 4.5 Proxy")]),t._v(" "),a("p",[t._v("如果是通过"),a("code",[t._v("vue-cli")]),t._v("脚手架工具搭建项目，我们可以通过"),a("code",[t._v("webpack")]),t._v("为我们起一个本地服务器作为请求的代理对象")]),t._v(" "),a("p",[t._v("通过该服务器转发请求至目标服务器，得到结果再转发给前端，但是最终发布上线时如果web应用和接口服务器不在一起仍会跨域")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("vue.config.js")]),t._v("文件，新增以下代码")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("devServer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vue项目启动时自动打开浏览器")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("proxy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'/api'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '/api'是代理标识，用于告诉node，url前面是/api的就是使用代理的")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("target")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://xxx.xxx.xx.xx:8080"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//目标地址，一般是指后台服务器地址")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("changeOrigin")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//是否跨域")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("pathRewrite")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// pathRewrite 的作用是把实际Request Url中的'/api'用\"\"代替")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'^/api'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" \n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("通过"),a("code",[t._v("axios")]),t._v("发送请求中，配置请求的根路径")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("axios"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("defaults"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baseURL "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api'")]),t._v("\n")])])]),a("p",[t._v("此外，还可通过服务端实现代理请求转发，以"),a("code",[t._v("express")]),t._v("框架为例")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" express "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" proxy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http-proxy-middleware'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("express"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("static")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("proxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("target")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:4000'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("changeOrigin")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app\n")])])]),a("h3",{attrs:{id:"_4-6-websocket"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-websocket"}},[t._v("#")]),t._v(" 4.6 websocket")]),t._v(" "),a("p",[a("code",[t._v("webSocket")]),t._v("本身不存在跨域问题，所以我们可以利用"),a("code",[t._v("webSocket")]),t._v("来进行非同源之间的通信")]),t._v(" "),a("p",[t._v("原理：利用"),a("code",[t._v("webSocket")]),t._v("的"),a("code",[t._v("API")]),t._v("，可以直接"),a("code",[t._v("new")]),t._v("一个"),a("code",[t._v("socket")]),t._v("实例，然后通过"),a("code",[t._v("open")]),t._v("方法内"),a("code",[t._v("send")]),t._v("要传输到后台的值，也可以利用"),a("code",[t._v("message")]),t._v("方法接收后台传来的数据。后台是通过"),a("code",[t._v("new WebSocket.Server({port:3000})")]),t._v("实例，利用"),a("code",[t._v("message")]),t._v("接收数据，利用"),a("code",[t._v("send")]),t._v("向客户端发送数据。具体看以下代码：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("socketConnect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 客户端与服务器进行连接")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" ws "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回`WebSocket`对象，赋值给变量ws")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 连接成功回调")]),t._v("\n    ws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onopen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'连接成功'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      ws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'我发送消息给服务端'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 客户端与服务器端通信")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听服务器端返回的信息")]),t._v("\n    ws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'服务器端返回：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do something")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回websocket对象")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" wsValue "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("socketConnect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ws://121.40.165.18:8800'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// websocket对象")]),t._v("\n")])])]),a("h3",{attrs:{id:"_4-7-document-domain-不常用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-document-domain-不常用"}},[t._v("#")]),t._v(" 4.7 document.domain（不常用）")]),t._v(" "),a("ul",[a("li",[t._v("该方式只能用于二级域名相同的情况下，比如 "),a("code",[t._v("a.test.com")]),t._v(" 和 "),a("code",[t._v("b.test.com")]),t._v(" 适用于该方式。")]),t._v(" "),a("li",[t._v("只需要给页面添加 "),a("code",[t._v("document.domain = 'test.com'")]),t._v(" 表示二级域名都相同就可以实现跨域")]),t._v(" "),a("li",[t._v("自 "),a("code",[t._v("Chrome 101")]),t._v(" 版本开始，"),a("code",[t._v("document.domain")]),t._v(" 将变为可读属性，也就是意味着上述这种跨域的方式被禁用了")])]),t._v(" "),a("h3",{attrs:{id:"_4-8-postmessage-不常用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-postmessage-不常用"}},[t._v("#")]),t._v(" 4.8 postMessage（不常用）")]),t._v(" "),a("p",[t._v("在两个 "),a("code",[t._v("origin")]),t._v(" 下分别部署一套页面 "),a("code",[t._v("A")]),t._v(" 与 "),a("code",[t._v("B")]),t._v("，"),a("code",[t._v("A")]),t._v(" 页面通过 "),a("code",[t._v("iframe")]),t._v(" 加载 "),a("code",[t._v("B")]),t._v(" 页面并监听消息，"),a("code",[t._v("B")]),t._v(" 页面发送消息")]),t._v(" "),a("blockquote",[a("p",[t._v("这种方式通常用于获取嵌入页面中的第三方页面数据。一个页面发送消息，另一个页面判断来源并接收消息")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送消息端")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://test.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 接收消息端")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" mc "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageChannel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" origin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("originalEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("origin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://test.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'验证通过'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_4-9-window-name-不常用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-9-window-name-不常用"}},[t._v("#")]),t._v(" 4.9 window.name（不常用）")]),t._v(" "),a("blockquote",[a("p",[t._v("主要是利用 "),a("code",[t._v("window.name")]),t._v(" 页面跳转不改变的特性实现跨域，即 "),a("code",[t._v("iframe")]),t._v(" 加载一个跨域页面，设置 "),a("code",[t._v("window.name")]),t._v("，跳转到同域页面，可以通过 "),a("code",[t._v("$('iframe').contentWindow.name")]),t._v(" 拿到跨域页面的数据")])]),t._v(" "),a("p",[a("strong",[t._v("实例说明")])]),t._v(" "),a("p",[t._v("比如有一个"),a("code",[t._v("www.example.com/a.html")]),t._v("页面。需要通过"),a("code",[t._v("a.html")]),t._v("页面里的"),a("code",[t._v("js")]),t._v("来获取另一个位于不同域上的页面"),a("code",[t._v("www.test.com/data.html")]),t._v("中的数据。")]),t._v(" "),a("p",[a("code",[t._v("data.html")]),t._v("页面中设置一个"),a("code",[t._v("window.name")]),t._v("即可,代码如下")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"我是data.html中设置的a页面想要的数据"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("ul",[a("li",[t._v("那么接下来问题来了，我们怎么把"),a("code",[t._v("data.html")]),t._v("页面载入进来呢，显然我们不能直接在"),a("code",[t._v("a.html")]),t._v("页面中通过改变"),a("code",[t._v("window.location")]),t._v("来载入"),a("code",[t._v("data.html")]),t._v("页面（因为我们现在需要实现的是"),a("code",[t._v("a.html")]),t._v("页面不跳转,但是也能够获取到"),a("code",[t._v("data.html")]),t._v("中的数据）")]),t._v(" "),a("li",[t._v("具体的实现其实就是在"),a("code",[t._v("a.html")]),t._v("页面中使用一个隐藏的"),a("code",[t._v("iframe")]),t._v("来充当一个中间角色，由"),a("code",[t._v("iframe")]),t._v("去获取"),a("code",[t._v("data.html")]),t._v("的数据，然后"),a("code",[t._v("a.html")]),t._v("再去得到"),a("code",[t._v("iframe")]),t._v("获取到的数据。")]),t._v(" "),a("li",[t._v("充当中间人的"),a("code",[t._v("iframe")]),t._v("想要获取到"),a("code",[t._v("data.html")]),t._v("中通过"),a("code",[t._v("window.name")]),t._v("设置的数据，只要要把这个"),a("code",[t._v("iframe")]),t._v("的"),a("code",[t._v("src")]),t._v("设置为"),a("code",[t._v("www.test.com/data.html")]),t._v("即可,然后"),a("code",[t._v("a.html")]),t._v("想要得到"),a("code",[t._v("iframe")]),t._v("所获取到的数据，也就是想要得到"),a("code",[t._v("iframe")]),t._v("的"),a("code",[t._v("widnow.name")]),t._v("的值，还必须把这个"),a("code",[t._v("iframe")]),t._v("的"),a("code",[t._v("src")]),t._v("设置成跟"),a("code",[t._v("a.html")]),t._v("页面同一个域才行，不然根据同源策略，"),a("code",[t._v("a.html")]),t._v("是不能访问到"),a("code",[t._v("iframe")]),t._v("中的"),a("code",[t._v("window.name")]),t._v("属性的")])]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- a.html中的代码 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("iframe")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("proxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.test.com/data.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token special-attr"}},[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token value css language-css"}},[a("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token special-attr"}},[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token value javascript language-javascript"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" iframe "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'proxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//上述即为获取iframe里的window.name也就是data.html页面中所设置的数据；")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b.html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//这里的b为随便的一个页面，只有与a.html同源就行，目的让a.html等访问到iframe里的东西，设置成about:blank也行")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("上面的代码只是最简单的原理演示代码，你可以对使用js封装上面的过程，比如动态的创建"),a("code",[t._v("iframe")]),t._v(",动态的注册各种事件等等，当然为了安全，获取完数据后，还可以销毁作为代理的"),a("code",[t._v("iframe")])]),t._v(" "),a("h3",{attrs:{id:"_4-10-扩展阅读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-10-扩展阅读"}},[t._v("#")]),t._v(" 4.10 扩展阅读")]),t._v(" "),a("p",[a("strong",[t._v("跨域与监控")])]),t._v(" "),a("p",[t._v("前端项目在统计前端报错监控时会遇到上报的内容只有 "),a("code",[t._v("Script Error")]),t._v(" 的问题。这个问题也是由同源策略引起。在 "),a("code",[t._v("<script>")]),t._v(" 标签上添加 "),a("code",[t._v('crossorigin="anonymous"')]),t._v(" 并且返回的 JS 文件响应头加上 "),a("code",[t._v("Access-Control-Allow-Origin: *")]),t._v(" 即可捕捉到完整的错误堆栈")]),t._v(" "),a("p",[a("strong",[t._v("跨域与图片")])]),t._v(" "),a("p",[t._v("前端项目在图片处理时可能会遇到图片绘制到 "),a("code",[t._v("Canvas")]),t._v(" 上之后却不能读取像素或导出 "),a("code",[t._v("base64")]),t._v(" 的问题。这个问题也是由同源策略引起。解决方式和上文相同，给图片添加 "),a("code",[t._v('crossorigin="anonymous"')]),t._v(" 并在返回的图片文件响应头加上 "),a("code",[t._v("Access-Control-Allow-Origin: *")]),t._v(" 即可解决")]),t._v(" "),a("h2",{attrs:{id:"_5-浏览器缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-浏览器缓存"}},[t._v("#")]),t._v(" 5 浏览器缓存")]),t._v(" "),a("blockquote",[a("p",[t._v("我们经常需要对业务中的一些数据进行存储，通常可以分为 短暂性存储 和 持久性储存。")])]),t._v(" "),a("ul",[a("li",[t._v("短暂性的时候，我们只需要将数据存在内存中，只在运行时可用")]),t._v(" "),a("li",[t._v("持久性存储，可以分为 浏览器端 与 服务器端\n"),a("ul",[a("li",[t._v("浏览器:\n"),a("ul",[a("li",[a("code",[t._v("cookie")]),t._v(": 通常用于存储用户身份，登录状态等\n"),a("ul",[a("li",[a("code",[t._v("http")]),t._v(" 中自动携带， 体积上限为 "),a("code",[t._v("4K")]),t._v("， 可自行设置过期时间")])])]),t._v(" "),a("li",[a("code",[t._v("localStorage / sessionStorage")]),t._v(": 长久储存/窗口关闭删除， 体积限制为 "),a("code",[t._v("4~5M")])]),t._v(" "),a("li",[a("code",[t._v("indexDB")])])])]),t._v(" "),a("li",[t._v("服务器:\n"),a("ul",[a("li",[t._v("分布式缓存 "),a("code",[t._v("redis")])]),t._v(" "),a("li",[t._v("数据库")])])])])])]),t._v(" "),a("blockquote",[a("p",[t._v("提示：如果平常有遇到过缓存的坑或者很好的利用缓存，可以讲解一下自己的使用场景。如果没有使用注意过缓存问题你也可以尝试讲解一下和我们息息相关的Webpack构建（每一次构建静态资源名称的"),a("code",[t._v("hash")]),t._v("值都会变化），它其实就跟缓存相关")])]),t._v(" "),a("blockquote",[a("p",[t._v("缓存分为强缓存和协商缓存。强缓存不过服务器，协商缓存需要过服务器，协商缓存返回的状态码是304。两类缓存机制可以同时存在，强缓存的优先级高于协商缓存。当执行强缓存时，如若缓存命中，则直接使用缓存数据库中的数据，不再进行缓存协商。")])]),t._v(" "),a("h3",{attrs:{id:"_6-1-强缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-强缓存"}},[t._v("#")]),t._v(" 6.1 强缓存")]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://s.poetries.top/uploads/2022/08/418cd4b22ded0606.png",loading:"lazy"}})]),t._v(" "),a("p",[a("strong",[t._v("Expires(HTTP1.0)")]),t._v("："),a("code",[t._v("Exprires")]),t._v("的值为服务端返回的数据到期时间。当再次请求时的请求时间小于返回的此时间，则直接使用缓存数据。但由于服务端时间和客户端时间可能有误差，这也将导致缓存命中的误差。另一方面，Expires是HTTP1.0的产物，故现在大多数使用"),a("code",[t._v("Cache-Control")]),t._v("替代")]),t._v(" "),a("blockquote",[a("p",[t._v("缺点：使用的是绝对时间，如果服务端和客户端的时间产生偏差，那么会导致命中缓存产生偏差。")])]),t._v(" "),a("p",[a("strong",[t._v("Cache-Control(HTTP1.1)")]),t._v("：有很多属性，不同的属性代表的意义也不同")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("private")]),t._v("：客户端可以缓存")]),t._v(" "),a("li",[a("code",[t._v("public")]),t._v("：客户端和代理服务器都可以缓存")]),t._v(" "),a("li",[a("code",[t._v("max-age=t")]),t._v("：缓存内容将在t秒后失效")]),t._v(" "),a("li",[a("code",[t._v("no-cache")]),t._v("：需要使用协商缓存来验证缓存数据，可以在客户端存储资源，每次都必须去服务端做新鲜度校验，来决定从服务端获取新的资源（"),a("code",[t._v("200")]),t._v("）还是使用客户端缓存（"),a("code",[t._v("304")]),t._v("）")]),t._v(" "),a("li",[a("code",[t._v("no-store")]),t._v("：所有内容都不会缓存，永远都不要在客户端存储资源，永远都去原始服务器去获取资源")])]),t._v(" "),a("blockquote",[a("p",[t._v("请注意"),a("code",[t._v("no-cache")]),t._v("指令很多人误以为是不缓存，这是不准确的，"),a("code",[t._v("no-cache")]),t._v("的意思是可以缓存，但每次用应该去向服务器验证缓存是否可用。"),a("code",[t._v("no-store")]),t._v("才是不缓存内容。当在首部字段"),a("code",[t._v("Cache-Control")]),t._v(" 有指定 "),a("code",[t._v("max-age")]),t._v(" 指令时，比起首部字段 Expires，会优先处理 "),a("code",[t._v("max-age")]),t._v(" 指令。命中强缓存的表现形式：Firefox浏览器表现为一个灰色的200状态码。Chrome浏览器状态码表现为200 ("),a("code",[t._v("from disk cache")]),t._v(")或是200 OK ("),a("code",[t._v("from memory cache")]),t._v(")")])]),t._v(" "),a("h3",{attrs:{id:"_6-2-协商缓存-对比缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-协商缓存-对比缓存"}},[t._v("#")]),t._v(" 6.2 协商缓存（对比缓存）")]),t._v(" "),a("blockquote",[a("p",[t._v("协商缓存需要进行对比判断是否可以使用缓存。浏览器第一次请求数据时，服务器会将缓存标识与数据一起响应给客户端，客户端将它们备份至缓存中。再次请求时，客户端会将缓存中的标识发送给服务器，服务器根据此标识判断。若未失效，返回304状态码，浏览器拿到此状态码就可以直接使用缓存数据了")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Last-Modified")]),t._v("：服务器在响应请求时，会告诉浏览器资源的最后修改时间")]),t._v(" "),a("li",[a("code",[t._v("if-Modified-Since")]),t._v("：浏览器再次请求服务器的时候，请求头会包含此字段，后面跟着在缓存中获得的最后修改时间。服务端收到此请求头发现有"),a("code",[t._v("if-Modified-Since")]),t._v("，则与被请求资源的最后修改时间进行对比，如果一致则返回304和响应报文头，浏览器只需要从缓存中获取信息即可")]),t._v(" "),a("li",[t._v("如果真的被修改：那么开始传输响应一个整体，服务器返回："),a("code",[t._v("200 OK")])]),t._v(" "),a("li",[t._v("如果没有被修改：那么只需传输响应"),a("code",[t._v("header")]),t._v("，服务器返回："),a("code",[t._v("304 Not Modified")])]),t._v(" "),a("li",[a("code",[t._v("Etag")]),t._v("：服务器响应请求时，通过此字段告诉浏览器当前资源在服务器生成的唯一标识（生成规则由服务器决定）")]),t._v(" "),a("li",[a("code",[t._v("If-Match")]),t._v("：条件请求，携带上一次请求中资源的"),a("code",[t._v("ETag")]),t._v("，服务器根据这个字段判断文件是否有新的修改")]),t._v(" "),a("li",[a("code",[t._v("If-None-Match")]),t._v("： 再次请求服务器时，浏览器的请求报文头部会包含此字段，后面的值为在缓存中获取的标识。服务器接收到次报文后发现"),a("code",[t._v("If-None-Match")]),t._v("则与被请求资源的唯一标识进行对比。")])]),t._v(" "),a("blockquote",[a("p",[t._v("但是实际应用中由于"),a("code",[t._v("Etag")]),t._v("的计算是使用算法来得出的，而算法会占用服务端计算的资源，所有服务端的资源都是宝贵的，所以就很少使用"),a("code",[t._v("Etag")]),t._v("了")])]),t._v(" "),a("ul",[a("li",[t._v("浏览器地址栏中写入"),a("code",[t._v("URL")]),t._v("，回车浏览器发现缓存中有这个文件了，不用继续请求了，直接去缓存拿（最快）")]),t._v(" "),a("li",[a("code",[t._v("F5")]),t._v("就是告诉浏览器，别偷懒，好歹去服务器看看这个文件是否有过期了。于是浏览器就胆胆襟襟的发送一个请求带上"),a("code",[t._v("If-Modify-since")])]),t._v(" "),a("li",[a("code",[t._v("Ctrl+F5")]),t._v("告诉浏览器，你先把你缓存中的这个文件给我删了，然后再去服务器请求个完整的资源文件下来。于是客户端就完成了强行更新的操作")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("总结")]),t._v(" "),a("ul",[a("li",[t._v("服务端判断客户端资源，是否和服务端资源一样。")]),t._v(" "),a("li",[t._v("一致则返回 "),a("code",[t._v("304")]),t._v("，否则返回 "),a("code",[t._v("200")]),t._v(" 和最新的资源")])]),t._v(" "),a("p",[a("strong",[t._v("资源标识：")])]),t._v(" "),a("ul",[a("li",[t._v("在 "),a("code",[t._v("Response Headers")]),t._v(" 中，有两种。")]),t._v(" "),a("li",[a("code",[t._v("Last-Modified")]),t._v("：资源的最后修改时间。")]),t._v(" "),a("li",[a("code",[t._v("Etag")]),t._v("：资源的唯一标识（一个字符串，类似于人类的指纹）")])]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://s.poetries.top/uploads/2022/08/4b918458db26d17b.png",loading:"lazy"}})]),t._v(" "),a("blockquote",[a("p",[t._v("服务端拿到 "),a("code",[t._v("if-Modified-Since")]),t._v(" 之后拿这个时间去和服务端资源最后修改时间做比较，如果一致则返回 "),a("code",[t._v("304")]),t._v(" ，不一致（也就是资源已经更新了）就返回 200 和新的资源及新的 "),a("code",[t._v("Last-Modified")])])]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://s.poetries.top/uploads/2022/08/aeec07248588bf72.png",loading:"lazy"}})]),t._v(" "),a("blockquote",[a("p",[t._v("其实 "),a("code",[t._v("Etag")]),t._v(" 和 "),a("code",[t._v("Last-Modified")]),t._v(" 一样的，只不过 "),a("code",[t._v("Etag")]),t._v(" 是服务端对资源按照一定方式（比如 "),a("code",[t._v("contenthash")]),t._v("）计算出来的唯一标识，就像人类指纹一样，传给客户端之后，客户端再传过来时候，服务端会将其与现在的资源计算出来的唯一标识做比较，一致则返回 "),a("code",[t._v("304")]),t._v("，不一致就返回 "),a("code",[t._v("200")]),t._v(" 和新的资源及新的 "),a("code",[t._v("Etag")])])]),t._v(" "),a("p",[a("strong",[t._v("两者比较：")])]),t._v(" "),a("ul",[a("li",[t._v("优先使用 "),a("code",[t._v("Etag")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("Last-Modified")]),t._v(" 只能精确到秒级。")]),t._v(" "),a("li",[t._v("如果资源被重复生成，而内容不变，则 "),a("code",[t._v("Etag")]),t._v(" 更精确。")])]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://s.poetries.top/uploads/2022/08/1d8b9e11dbaca97f.png",loading:"lazy"}})]),t._v(" "),a("p",[a("strong",[t._v("三种刷新操作对 http 缓存的影响")])]),t._v(" "),a("ul",[a("li",[t._v("正常操作：地址栏输入 "),a("code",[t._v("url")]),t._v("，跳转链接，前进后退等")]),t._v(" "),a("li",[t._v("手动刷新："),a("code",[t._v("f5")]),t._v("，点击刷新按钮，右键菜单刷新")]),t._v(" "),a("li",[t._v("强制刷新："),a("code",[t._v("ctrl + f5")]),t._v("，"),a("code",[t._v("shift+command+r")])])]),t._v(" "),a("blockquote",[a("ul",[a("li",[a("strong",[t._v("正常操作")]),t._v("：强制缓存有效，协商缓存有效")]),t._v(" "),a("li",[a("strong",[t._v("手动刷新")]),t._v("：强制缓存失效，协商缓存有效")]),t._v(" "),a("li",[a("strong",[t._v("强制刷新")]),t._v("：强制缓存失效，协商缓存失效")])])])]),t._v(" "),a("h3",{attrs:{id:"_6-3-缓存场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-缓存场景"}},[t._v("#")]),t._v(" 6.3 缓存场景")]),t._v(" "),a("blockquote",[a("p",[t._v("对于大部分的场景都可以使用强缓存配合协商缓存解决，但是在一些特殊的地方可能需要选择特殊的缓存策")])]),t._v(" "),a("ul",[a("li",[t._v("对于某些不需要缓存的资源，可以使用 "),a("code",[t._v("Cache-control: no-store")]),t._v(" ，表示该资源不需要缓存")]),t._v(" "),a("li",[t._v("对于频繁变动的资源，可以使用 "),a("code",[t._v("Cache-Control: no-cache")]),t._v(" 并配合 "),a("code",[t._v("ETag")]),t._v(" 使用，表示该资源已被缓存，但是每次都会发送请求询问资源是否更新")]),t._v(" "),a("li",[t._v("对于代码文件来说，通常使用 "),a("code",[t._v("Cache-Control: max-age=31536000")]),t._v(" 并配合策略缓存使用，然后对文件进行指纹处理，一旦文件名变动就会立刻下载新的文件")])]),t._v(" "),a("h3",{attrs:{id:"_6-4-讲讲304"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-讲讲304"}},[t._v("#")]),t._v(" 6.4 讲讲304")]),t._v(" "),a("blockquote",[a("p",[t._v("如果客户端发送了一个带条件的 "),a("code",[t._v("GET")]),t._v(" 请求且该请求已被允许，而文档的内容(自上次访问以来或者根据请求的条件)并没有改变，则服务器应当返回这个 "),a("code",[t._v("304")]),t._v(" 状态码")])]),t._v(" "),a("h3",{attrs:{id:"_6-5-强缓存、协商缓存什么时候用哪个"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-强缓存、协商缓存什么时候用哪个"}},[t._v("#")]),t._v(" 6.5 强缓存、协商缓存什么时候用哪个")]),t._v(" "),a("blockquote",[a("p",[t._v("因为服务器上的资源不是一直固定不变的，大多数情况下它会更新，这个时候如果我们 还访问本地缓存，那么对用户来说，那就相当于资源没有更新，用户看到的还是旧的资 源;所以我们希望服务器上的资源更新了浏览器就请求新的资源，没有更新就使用本地 的缓存，以最大程度的减少因网络请求而产生的资源浪费。")])]),t._v(" "),a("h3",{attrs:{id:"_6-6-缓存总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-缓存总结"}},[t._v("#")]),t._v(" 6.6 缓存总结")]),t._v(" "),a("blockquote",[a("p",[t._v("缓存分为两种:强缓存和协商缓存，根据响应的 "),a("code",[t._v("header")]),t._v(" 内容来决定。")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("获取资源形式")]),t._v(" "),a("th",[t._v("状态码")]),t._v(" "),a("th",[t._v("发送请求到服务器")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("强缓存")]),t._v(" "),a("td",[t._v("从缓存取")]),t._v(" "),a("td",[a("code",[t._v("200(from cache)")])]),t._v(" "),a("td",[t._v("否，直接从缓存取")])]),t._v(" "),a("tr",[a("td",[t._v("协商缓存")]),t._v(" "),a("td",[t._v("从缓存取")]),t._v(" "),a("td",[a("code",[t._v("304(not modified)")])]),t._v(" "),a("td",[t._v("是，通过服务器来告知缓存是否可 用")])])])]),t._v(" "),a("ul",[a("li",[t._v("强缓存相关字段有 "),a("code",[t._v("expires")]),t._v("，"),a("code",[t._v("cache-control")]),t._v("。如果 "),a("code",[t._v("cache-control")]),t._v(" 与 "),a("code",[t._v("expires")]),t._v(" 同时存在的话， "),a("code",[t._v("cache-control")]),t._v(" 的优先级高于 "),a("code",[t._v("expires")]),t._v("。")]),t._v(" "),a("li",[t._v("协商缓存相关字段有 "),a("code",[t._v("Last-Modified/If-Modified-Since")]),t._v("，"),a("code",[t._v("Etag/If-None-Match")])])]),t._v(" "),a("h3",{attrs:{id:"_6-7-cookie和localsrorage、session、indexdb-的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-7-cookie和localsrorage、session、indexdb-的区别"}},[t._v("#")]),t._v(" 6.7 cookie和localSrorage、session、indexDB 的区别")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("特性")]),t._v(" "),a("th",[t._v("cookie")]),t._v(" "),a("th",[t._v("localStorage")]),t._v(" "),a("th",[t._v("sessionStorage")]),t._v(" "),a("th",[t._v("indexDB")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("数据生命周期")]),t._v(" "),a("td",[t._v("一般由服务器生成，可以设置过期时间")]),t._v(" "),a("td",[t._v("除非被清理，否则一直存在")]),t._v(" "),a("td",[t._v("页面关闭就清理")]),t._v(" "),a("td",[t._v("除非被清理，否则一直存在")])]),t._v(" "),a("tr",[a("td",[t._v("数据存储大小")]),t._v(" "),a("td",[a("code",[t._v("4K")])]),t._v(" "),a("td",[a("code",[t._v("5M")])]),t._v(" "),a("td",[a("code",[t._v("5M")])]),t._v(" "),a("td",[t._v("无限")])]),t._v(" "),a("tr",[a("td",[t._v("与服务端通信")]),t._v(" "),a("td",[t._v("每次都会携带在 "),a("code",[t._v("header")]),t._v(" 中，对于请求性能影响")]),t._v(" "),a("td",[t._v("不参与")]),t._v(" "),a("td",[t._v("不参与")]),t._v(" "),a("td",[t._v("不参与")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("从上表可以看到，"),a("code",[t._v("cookie")]),t._v(" 已经不建议用于存储。如果没有大量数据存储需求的话，可以使用 "),a("code",[t._v("localStorage")]),t._v("和 "),a("code",[t._v("sessionStorage")]),t._v(" 。对于不怎么改变的数据尽量使用 "),a("code",[t._v("localStorage")]),t._v(" 存储，否则可以用 "),a("code",[t._v("sessionStorage")]),t._v(" 存储。")])]),t._v(" "),a("p",[a("strong",[t._v("对于 "),a("code",[t._v("cookie")]),t._v("，我们还需要注意安全性")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性")]),t._v(" "),a("th",[t._v("作用")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("value")])]),t._v(" "),a("td",[t._v("如果用于保存用户登录态，应该将该值加密，不能使用明文的用户标识")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("http-only")])]),t._v(" "),a("td",[t._v("不能通过 "),a("code",[t._v("JS")]),t._v("访问 "),a("code",[t._v("Cookie")]),t._v("，减少 "),a("code",[t._v("XSS")]),t._v("攻击")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("secure")])]),t._v(" "),a("td",[t._v("只能在协议为 "),a("code",[t._v("HTTPS")]),t._v(" 的请求中携带")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("same-site")])]),t._v(" "),a("td",[t._v("规定浏览器不能在跨域请求中携带 "),a("code",[t._v("Cookie")]),t._v("，减少 "),a("code",[t._v("CSRF")]),t._v(" 攻击")])])])]),t._v(" "),a("h3",{attrs:{id:"_6-8-什么是-cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-8-什么是-cookie"}},[t._v("#")]),t._v(" 6.8 什么是 Cookie")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("HTTP 是无状态的协议")]),t._v("（对于事务处理没有记忆能力，每次客户端和服务端会话完成时，服务端不会保存任何会话信息）：每个请求都是完全独立的，服务端无法确认当前访问者的身份信息，无法分辨上一次的请求发送者和这一次的发送者是不是同一个人。所以服务器与浏览器为了进行会话跟踪（知道是谁在访问我），就必须主动的去维护一个状态，这个状态用于告知服务端前后两个请求是否来自同一浏览器。而这个状态需要通过 "),a("code",[t._v("cookie")]),t._v(" 或者 "),a("code",[t._v("session")]),t._v(" 去实现")]),t._v(" "),a("li",[a("strong",[t._v("cookie 存储在客户端")]),t._v("： "),a("code",[t._v("cookie")]),t._v(" 是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上")]),t._v(" "),a("li",[a("strong",[t._v("cookie 是不可跨域的")]),t._v("： 每个 "),a("code",[t._v("cookie")]),t._v(" 都会绑定单一的域名，无法在别的域名下获取使用，"),a("strong",[t._v("一级域名和二级域名之间是允许共享使用的")]),t._v("（靠的是 "),a("code",[t._v("domain")]),t._v("）")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("name=value")])]),t._v(" "),a("td",[t._v("键值对，设置 "),a("code",[t._v("Cookie")]),t._v(" 的名称及相对应的值，都必须是字符串类型。如果值为 "),a("code",[t._v("Unicode")]),t._v(" 字符，需要为字符编码。如果值为二进制数据，则需要使用 "),a("code",[t._v("BASE64")]),t._v(" 编码。")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("domain")])]),t._v(" "),a("td",[t._v("指定 "),a("code",[t._v("cookie")]),t._v(" 所属域名，默认是当前域名")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("path")])]),t._v(" "),a("td",[t._v("指定 "),a("code",[t._v("cookie")]),t._v(" 在哪个路径（路由）下生效，默认是 "),a("code",[t._v("'/'")]),t._v("。如果设置为 "),a("code",[t._v("/abc")]),t._v("，则只有 "),a("code",[t._v("/abc")]),t._v(" 下的路由可以访问到该 "),a("code",[t._v("cookie")]),t._v("，如："),a("code",[t._v("/abc/read")]),t._v("。")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("maxAge")])]),t._v(" "),a("td",[a("code",[t._v("cookie")]),t._v(" 失效的时间，单位秒。如果为整数，则该 "),a("code",[t._v("cookie")]),t._v(" 在 "),a("code",[t._v("maxAge")]),t._v(" 秒后失效。如果为负数，该 "),a("code",[t._v("cookie")]),t._v(" 为临时 "),a("code",[t._v("cookie")]),t._v(" ，关闭浏览器即失效，浏览器也不会以任何形式保存该 "),a("code",[t._v("cookie")]),t._v(" 。如果为 "),a("code",[t._v("0")]),t._v("，表示删除该 "),a("code",[t._v("cookie")]),t._v(" 。默认为 "),a("code",[t._v("-1")]),t._v("。- 比 "),a("code",[t._v("expires")]),t._v(" 好用。")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("expires")])]),t._v(" "),a("td",[t._v("过期时间，在设置的某个时间点后该 "),a("code",[t._v("cookie")]),t._v(" 就会失效。一般浏览器的 "),a("code",[t._v("cookie")]),t._v(" 都是默认储存的，当关闭浏览器结束这个会话的时候，这个 "),a("code",[t._v("cookie")]),t._v(" 也就会被删除")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("secure")])]),t._v(" "),a("td",[t._v("该 cookie 是否仅被使用安全协议传输。安全协议有 "),a("code",[t._v("HTTPS")]),t._v("，"),a("code",[t._v("SSL")]),t._v("等，在网络上传输数据之前先将数据加密。默认为"),a("code",[t._v("false")]),t._v("。当 "),a("code",[t._v("secure")]),t._v(" 值为 "),a("code",[t._v("true")]),t._v(" 时，"),a("code",[t._v("cookie")]),t._v(" 在 "),a("code",[t._v("HTTP")]),t._v(" 中是无效，在 "),a("code",[t._v("HTTPS")]),t._v(" 中才有效")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("httpOnly")])]),t._v(" "),a("td",[t._v("如果给某个 "),a("code",[t._v("cookie")]),t._v(" 设置了 "),a("code",[t._v("httpOnly")]),t._v(" 属性，则无法通过 JS 脚本 读取到该 "),a("code",[t._v("cookie")]),t._v(" 的信息，但还是能通过 "),a("code",[t._v("Application")]),t._v(" 中手动修改 "),a("code",[t._v("cookie")]),t._v("，所以只是在一定程度上可以防止 "),a("code",[t._v("XSS")]),t._v(" 攻击，不是绝对的安全")])])])]),t._v(" "),a("h3",{attrs:{id:"_6-9-什么是-session"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-9-什么是-session"}},[t._v("#")]),t._v(" 6.9 什么是 Session")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("session")]),t._v(" 是另一种记录服务器和客户端会话状态的机制")]),t._v(" "),a("li",[a("code",[t._v("session")]),t._v(" 是基于 "),a("code",[t._v("cookie")]),t._v(" 实现的，"),a("code",[t._v("session")]),t._v(" 存储在服务器端，"),a("code",[t._v("sessionId")]),t._v(" 会被存储到客户端的"),a("code",[t._v("cookie")]),t._v(" 中")])]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://s.poetries.top/uploads/2022/08/053ef73d5751267e.png",loading:"lazy"}})]),t._v(" "),a("p",[a("strong",[t._v("session 认证流程：")])]),t._v(" "),a("ul",[a("li",[t._v("用户第一次请求服务器的时候，服务器根据用户提交的相关信息，创建对应的 "),a("code",[t._v("Session")])]),t._v(" "),a("li",[t._v("请求返回时将此 "),a("code",[t._v("Session")]),t._v(" 的唯一标识信息 "),a("code",[t._v("SessionID")]),t._v(" 返回给浏览器")]),t._v(" "),a("li",[t._v("浏览器接收到服务器返回的 "),a("code",[t._v("SessionID")]),t._v(" 信息后，会将此信息存入到 "),a("code",[t._v("Cookie")]),t._v(" 中，同时 "),a("code",[t._v("Cookie")]),t._v(" 记录此 "),a("code",[t._v("SessionID")]),t._v(" 属于哪个域名")]),t._v(" "),a("li",[t._v("当用户第二次访问服务器的时候，请求会自动判断此域名下是否存在 "),a("code",[t._v("Cookie")]),t._v(" 信息，如果存在自动将 "),a("code",[t._v("Cookie")]),t._v(" 信息也发送给服务端，服务端会从 "),a("code",[t._v("Cookie")]),t._v(" 中获取 "),a("code",[t._v("SessionID")]),t._v("，再根据 "),a("code",[t._v("SessionID")]),t._v(" 查找对应的 "),a("code",[t._v("Session")]),t._v(" 信息，如果没有找到说明用户没有登录或者登录失效，如果找到 "),a("code",[t._v("Session")]),t._v(" 证明用户已经登录可执行后面操作。")])]),t._v(" "),a("blockquote",[a("p",[t._v("根据以上流程可知，"),a("code",[t._v("SessionID")]),t._v(" 是连接 "),a("code",[t._v("Cookie")]),t._v(" 和 "),a("code",[t._v("Session")]),t._v(" 的一道桥梁，大部分系统也是根据此原理来验证用户登录状态。")])]),t._v(" "),a("h3",{attrs:{id:"_6-10-cookie-和-session-的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-10-cookie-和-session-的区别"}},[t._v("#")]),t._v(" 6.10 Cookie 和 Session 的区别")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("安全性")]),t._v("： "),a("code",[t._v("Session")]),t._v(" 比 "),a("code",[t._v("Cookie")]),t._v(" 安全，"),a("code",[t._v("Session")]),t._v(" 是存储在服务器端的，"),a("code",[t._v("Cookie")]),t._v(" 是存储在客户端的。")]),t._v(" "),a("li",[a("strong",[t._v("存取值的类型不同")]),t._v("：Cookie 只支持存字符串数据，想要设置其他类型的数据，需要将其转换成字符串，"),a("code",[t._v("Session")]),t._v(" 可以存任意数据类型。")]),t._v(" "),a("li",[a("strong",[t._v("有效期不同")]),t._v("： "),a("code",[t._v("Cookie")]),t._v(" 可设置为长时间保持，比如我们经常使用的默认登录功能，"),a("code",[t._v("Session")]),t._v(" 一般失效时间较短，客户端关闭（默认情况下）或者 "),a("code",[t._v("Session")]),t._v(" 超时都会失效。")]),t._v(" "),a("li",[a("strong",[t._v("存储大小不同")]),t._v("： 单个 "),a("code",[t._v("Cookie")]),t._v(" 保存的数据不能超过 "),a("code",[t._v("4K")]),t._v("，"),a("code",[t._v("Session")]),t._v(" 可存储数据远高于 "),a("code",[t._v("Cookie")]),t._v("，但是当访问量过多，会占用过多的服务器资源。")])]),t._v(" "),a("h2",{attrs:{id:"_6-内存泄露"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-内存泄露"}},[t._v("#")]),t._v(" 6 内存泄露")]),t._v(" "),a("ul",[a("li",[t._v("意外的全局变量: 无法被回收")]),t._v(" "),a("li",[t._v("定时器: 未被正确关闭，导致所引用的外部变量无法被释放")]),t._v(" "),a("li",[t._v("事件监听: 没有正确销毁 (低版本浏览器可能出现)")]),t._v(" "),a("li",[t._v("闭包: 会导致父级中的变量无法被释放")]),t._v(" "),a("li",[a("code",[t._v("dom")]),t._v(" 引用: "),a("code",[t._v("dom")]),t._v(" 元素被删除时，内存中的引用未被正确清空")])]),t._v(" "),a("blockquote",[a("p",[t._v("可用 "),a("code",[t._v("chrome")]),t._v(" 中的 "),a("code",[t._v("timeline")]),t._v(" 进行内存标记，可视化查看内存的变化情况，找出异常点。")])]),t._v(" "),a("h2",{attrs:{id:"_7-浏览器api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-浏览器api"}},[t._v("#")]),t._v(" 7 浏览器API")]),t._v(" "),a("h3",{attrs:{id:"_7-1-web-worker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-web-worker"}},[t._v("#")]),t._v(" 7.1 Web Worker")]),t._v(" "),a("blockquote",[a("p",[t._v("现代浏览器为"),a("code",[t._v("JavaScript")]),t._v("创造的 多线程环境。可以新建并将部分任务分配到"),a("code",[t._v("worker")]),t._v("线程并行运行，两个线程可 独立运行，互不干扰，可通过自带的 消息机制 相互通信。")])]),t._v(" "),a("p",[a("strong",[t._v("基本用法:")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建 worker")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" worker "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Worker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'work.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 向主进程推送消息")]),t._v("\nworker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听主进程来的消息")]),t._v("\nworker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Received message '")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("限制:")])]),t._v(" "),a("ul",[a("li",[t._v("同源限制")]),t._v(" "),a("li",[t._v("无法使用 "),a("code",[t._v("document / window / alert / confirm")])]),t._v(" "),a("li",[t._v("无法加载本地资源")])]),t._v(" "),a("h3",{attrs:{id:"_7-2-service-worker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-service-worker"}},[t._v("#")]),t._v(" 7.2 Service Worker")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("service worker")]),t._v(" "),a("p",[a("code",[t._v("Service workers")]),t._v(" 本质上充当Web应用程序与浏览器之间的代理服务器，也可以在网络可用时作为浏览器和网络间的代理。它们旨在（除其他之外）使得能够创建有效的离线体验，拦截网络请求并基于网络是否可用以及更新的资源是否驻留在服务器上来采取适当的动作。他们还允许访问推送通知和后台同步API")])]),t._v(" "),a("p",[a("strong",[t._v("目前该技术通常用来做缓存文件，提高首屏速度")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// index.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("navigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  navigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sw.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("registration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"service worker 注册成功"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"servcie worker 注册失败"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sw.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听 `install` 事件，回调中缓存所需文件")]),t._v("\nself"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"install"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("waitUntil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    caches"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-cache"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("cache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addAll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./index.html"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拦截所有请求事件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果缓存中已经有请求的数据就直接用缓存，否则去请求数据")]),t._v("\nself"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fetch"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("respondWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    caches"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fetch source"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("打开页面，可以在开发者工具中的 "),a("code",[t._v("Application")]),t._v(" 看到 "),a("code",[t._v("Service Worker")]),t._v(" 已经启动了")])]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://s.poetries.top/gitee/2020/09/96.png",loading:"lazy"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在 Cache 中也可以发现我们所需的文件已被缓存")])]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://s.poetries.top/gitee/2020/09/97.png",loading:"lazy"}})]),t._v(" "),a("blockquote",[a("p",[t._v("当我们重新刷新页面可以发现我们缓存的数据是从 "),a("code",[t._v("Service")]),t._v(" "),a("code",[t._v("Worker")]),t._v(" 中读取的")])]),t._v(" "),a("h3",{attrs:{id:"_7-3-requestanimationframe用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-requestanimationframe用法"}},[t._v("#")]),t._v(" 7.3 requestAnimationFrame用法")]),t._v(" "),a("blockquote",[a("p",[t._v("在Web应用中，实现动画效果的方法比较多，"),a("code",[t._v("Javascript")]),t._v(" 中可以通过定时器 "),a("code",[t._v("setTimeout")]),t._v(" 来实现，"),a("code",[t._v("css3")]),t._v(" 可以使用 "),a("code",[t._v("transition")]),t._v(" 和 "),a("code",[t._v("animation")]),t._v(" 来实现，"),a("code",[t._v("html5")]),t._v(" 中的 "),a("code",[t._v("canvas")]),t._v(" 也可以实现。除此之外，html5 还提供一个专门用于请求动画的"),a("code",[t._v("API")]),t._v("，那就是 "),a("code",[t._v("requestAnimationFrame")]),t._v("，顾名思义就是请求动画帧")])]),t._v(" "),a("h4",{attrs:{id:"_1-页面可见"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-页面可见"}},[t._v("#")]),t._v(" 1.页面可见")]),t._v(" "),a("blockquote",[a("p",[t._v("当页面被最小化或者被切换成后台标签页时，页面为不可见，浏览器会触发一个 "),a("code",[t._v("visibilitychange")]),t._v("事件,并设置"),a("code",[t._v("document.hidden")]),t._v("属性为true；切换到显示状态时，页面为可见，也同样触发一个 "),a("code",[t._v("visibilitychange")]),t._v(" 事件，设置"),a("code",[t._v("document.hidden")]),t._v("属性为"),a("code",[t._v("false")])])]),t._v(" "),a("h4",{attrs:{id:"_2-动画帧请求回调函数列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-动画帧请求回调函数列表"}},[t._v("#")]),t._v(" 2.动画帧请求回调函数列表")]),t._v(" "),a("blockquote",[a("p",[t._v("每个"),a("code",[t._v("Document")]),t._v("都有一个动画帧请求回调函数列表，该列表可以看成是由"),a("code",[t._v("<handlerId, callback>")]),t._v("元组组成的集合。其中"),a("code",[t._v("handlerId")]),t._v("是一个整数，唯一地标识了元组在列表中的位置；"),a("code",[t._v("callback")]),t._v("是回调函数")])]),t._v(" "),a("h4",{attrs:{id:"_3-屏幕刷新频率"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-屏幕刷新频率"}},[t._v("#")]),t._v(" 3.屏幕刷新频率")]),t._v(" "),a("blockquote",[a("p",[t._v("即图像在屏幕上更新的速度，也即屏幕上的图像每秒钟出现的次数，它的单位是赫兹(Hz)。 对于一般笔记本电脑，这个频率大概是"),a("code",[t._v("60Hz")]),t._v("， 这个值的设定受屏幕分辨率、屏幕尺寸和显卡的影响")])]),t._v(" "),a("h4",{attrs:{id:"_4-动画原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-动画原理"}},[t._v("#")]),t._v(" 4.动画原理")]),t._v(" "),a("blockquote",[a("p",[t._v("根据上面的原理我们知道，你眼前所看到图像正在以每秒60次的频率刷新，由于刷新频率很高，因此你感觉不到它在刷新。而动画本质就是要让人眼看到图像被刷新而引起变化的视觉效果，这个变化要以连贯的、平滑的方式进行过渡。 那怎么样才能做到这种效果呢")])]),t._v(" "),a("p",[t._v("刷新频率为"),a("code",[t._v("60Hz")]),t._v("的屏幕每"),a("code",[t._v("16.7ms")]),t._v("刷新一次，我们在屏幕每次刷新前，将图像的位置向左移动一个像素，即"),a("code",[t._v("1px")]),t._v("。这样一来，屏幕每次刷出来的图像位置都比前一个要差"),a("code",[t._v("1px")]),t._v("，因此你会看到图像在移动；由于我们人眼的视觉停留效应，当前位置的图像停留在大脑的印象还没消失，紧接着图像又被移到了下一个位置，因此你才会看到图像在流畅的移动，这就是视觉效果上形成的动画")]),t._v(" "),a("h4",{attrs:{id:"_5-requestanimationframe用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-requestanimationframe用法"}},[t._v("#")]),t._v(" 5.requestAnimationFrame用法")]),t._v(" "),a("p",[t._v("异步，传入的函数在重绘之前调用")]),t._v(" "),a("p",[a("strong",[t._v("1. 写法："),a("code",[t._v("handlerId = requestAnimationFrame(callback)")])])]),t._v(" "),a("ul",[a("li",[t._v("传入一个"),a("code",[t._v("callback")]),t._v("函数，即动画函数")]),t._v(" "),a("li",[t._v("返回值"),a("code",[t._v("handlerId")]),t._v("为浏览器定义的、大于"),a("code",[t._v("0")]),t._v("的整数，唯一标识了该回调函数在列表中位置")])]),t._v(" "),a("p",[a("strong",[t._v("2. 浏览器执行过程")])]),t._v(" "),a("ul",[a("li",[t._v("首先要判断"),a("code",[t._v("document.hidden")]),t._v("属性是否为"),a("code",[t._v("true")]),t._v(",即页面处于可见状态下才会执行")]),t._v(" "),a("li",[t._v("浏览器清空上一轮的动画函数")]),t._v(" "),a("li",[t._v("这个方法返回的"),a("code",[t._v("handlerId")]),t._v(" 值会和动画函数"),a("code",[t._v("callback")]),t._v("，以"),a("code",[t._v("<handlerId , callback>")]),t._v(" 进入到动画帧请求回调函数列")]),t._v(" "),a("li",[t._v("浏览器会遍历动画帧请求回调函数列表，根据"),a("code",[t._v("handlerId")]),t._v(" 的值大小，依次去执行相应的动画函数")])]),t._v(" "),a("p",[a("strong",[t._v("3. 取消动画函数的方法")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cancelAnimationFrame(handlerId)\n")])])]),a("h4",{attrs:{id:"_6-与settimeout对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-与settimeout对比"}},[t._v("#")]),t._v(" 6.与setTimeout对比")]),t._v(" "),a("blockquote",[a("p",[t._v("理解了上面的概念以后，我们不难发现，"),a("code",[t._v("setTimeout")]),t._v(" 其实就是通过设置一个间隔时间来不断的改变图像的位置，从而达到动画效果的。但利用seTimeout实现的动画在某些低端机上会出现卡顿、抖动的现象。 这种现象的产生有两个原因")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("setTimeout")]),t._v("的执行时间并不是确定的。在Javascript中， "),a("code",[t._v("setTimeout")]),t._v(" 任务被放进了异步队列中，只有当主线程上的任务执行完以后，才会去检查该队列里的任务是否需要开始执行，因此 "),a("code",[t._v("setTimeout")]),t._v(" 的实际执行时间一般要比其设定的时间晚一些")]),t._v(" "),a("li",[t._v("刷新频率受屏幕分辨率和屏幕尺寸的影响，因此不同设备的屏幕刷新频率可能会不同，而 setTimeout只能设置一个固定的时间间隔，这个时间不一定和屏幕的刷新时间相同。")])]),t._v(" "),a("blockquote",[a("p",[t._v("以上两种情况都会导致"),a("code",[t._v("setTimeout")]),t._v("的执行步调和屏幕的刷新步调不一致，从而引起丢帧现象。 那为什么步调不一致就会引起丢帧呢")])]),t._v(" "),a("blockquote",[a("p",[t._v("首先要明白，"),a("code",[t._v("setTimeout")]),t._v("的执行只是在内存中对图像属性进行改变，这个变化必须要等到屏幕下次刷新时才会被更新到屏幕上。如果两者的步调不一致，就可能会导致中间某一帧的操作被跨越过去，而直接更新下一帧的图像。假设屏幕每隔"),a("code",[t._v("16.7ms")]),t._v("刷新一次，而"),a("code",[t._v("setTimeout")]),t._v("每隔"),a("code",[t._v("10ms")]),t._v("设置图像向左移动"),a("code",[t._v("1px")]),t._v("， 就会出现如下绘制过程：")])]),t._v(" "),a("ul",[a("li",[t._v("第"),a("code",[t._v("0ms")]),t._v(":  屏幕未刷新，等待中，"),a("code",[t._v("setTimeout")]),t._v("也未执行，等待中；")]),t._v(" "),a("li",[t._v("第"),a("code",[t._v("10ms")]),t._v(":  屏幕未刷新，等待中，"),a("code",[t._v("setTimeout")]),t._v("开始执行并设置图像属性"),a("code",[t._v("left=1px")]),t._v("；")]),t._v(" "),a("li",[t._v("第"),a("code",[t._v("16.7ms")]),t._v(":  屏幕开始刷新，屏幕上的图像向左移动了"),a("code",[t._v("1px")]),t._v("， "),a("code",[t._v("setTimeout")]),t._v(" 未执行，继续等待中；")]),t._v(" "),a("li",[t._v("第"),a("code",[t._v("20ms")]),t._v(":  屏幕未刷新，等待中，"),a("code",[t._v("setTimeout")]),t._v("开始执行并设置"),a("code",[t._v("left=2px")]),t._v(";")]),t._v(" "),a("li",[t._v("第"),a("code",[t._v("30ms")]),t._v(":  屏幕未刷新，等待中，"),a("code",[t._v("setTimeout")]),t._v("开始执行并设置"),a("code",[t._v("left=3px")]),t._v(";")]),t._v(" "),a("li",[t._v("第"),a("code",[t._v("33.4ms")]),t._v(": 屏幕开始刷新，屏幕上的图像向左移动了"),a("code",[t._v("3px")]),t._v("， "),a("code",[t._v("setTimeout")]),t._v("未执行，继续等待中；\n…")])]),t._v(" "),a("blockquote",[a("p",[t._v("从上面的绘制过程中可以看出，屏幕没有更新"),a("code",[t._v("left=2px")]),t._v("的那一帧画面，图像直接从1px的位置跳到了3px的的位置，这就是丢帧现象，这种现象就会引起动画卡顿")])]),t._v(" "),a("blockquote",[a("p",[t._v("与"),a("code",[t._v("setTimeout")]),t._v("相比，"),a("code",[t._v("requestAnimationFrame")]),t._v("最大的优势是由系统来决定回调函数的执行时机。具体一点讲，如果屏幕刷新率是"),a("code",[t._v("60Hz")]),t._v(",那么回调函数就每16.7ms被执行一次，如果刷新率是"),a("code",[t._v("75Hz")]),t._v("，那么这个时间间隔就变成了"),a("code",[t._v("1000/75=13.3ms")]),t._v("，换句话说就是，"),a("code",[t._v("requestAnimationFrame")]),t._v("的步伐跟着系统的刷新步伐走。它能保证回调函数在屏幕每一次的刷新间隔中只被执行一次，这样就不会引起丢帧现象，也不会导致动画出现卡顿的问题。")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" progress "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//回调函数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n  progress "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//修改图像的位置  ")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("progress "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在动画没有结束前，递归渲染    ")]),t._v("\n    window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("render"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//第一帧渲染")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("render"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("strong",[t._v("除此之外，requestAnimationFrame还有以下两个优势")])]),t._v(" "),a("ul",[a("li",[t._v("CPU节能：使用"),a("code",[t._v("setTimeout")]),t._v("实现的动画，当页面被隐藏或最小化时，"),a("code",[t._v("setTimeout")]),t._v(" 仍然在后台执行动画任务，由于此时页面处于不可见或不可用状态，刷新动画是没有意义的，完全是浪费CPU资源。而"),a("code",[t._v("requestAnimationFrame")]),t._v("则完全不同，当页面处理未激活的状态下，该页面的屏幕刷新任务也会被系统暂停，因此跟着系统步伐走的"),a("code",[t._v("requestAnimationFrame")]),t._v("也会停止渲染，当页面被激活时，动画就从上次停留的地方继续执行，有效节省了"),a("code",[t._v("CPU")]),t._v("开销")]),t._v(" "),a("li",[t._v("函数节流：在高频率事件("),a("code",[t._v("resize")]),t._v(","),a("code",[t._v("scroll")]),t._v("等)中，为了防止在一个刷新间隔内发生多次函数执行，使用"),a("code",[t._v("requestAnimationFrame")]),t._v("可保证每个刷新间隔内，函数只被执行一次，这样既能保证流畅性，也能更好的节省函数执行的开销。一个刷新间隔内函数执行多次时没有意义的，因为显示器每"),a("code",[t._v("16.7ms")]),t._v("刷新一次，多次绘制并不会在屏幕上体现出来")])]),t._v(" "),a("h4",{attrs:{id:"_7-优雅降级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-优雅降级"}},[t._v("#")]),t._v(" 7.优雅降级")]),t._v(" "),a("blockquote",[a("p",[t._v("由于"),a("code",[t._v("requestAnimationFrame")]),t._v("目前还存在兼容性问题，而且不同的浏览器还需要带不同的前缀。因此需要通过优雅降级的方式对"),a("code",[t._v("requestAnimationFrame")]),t._v("进行封装，优先使用高级特性，然后再根据不同浏览器的情况进行回退，直至只能使用"),a("code",[t._v("setTimeout")]),t._v("的情况。下面的代码就是有人在github上提供的polyfill，详细介绍请参考github代码 "),a("a",{attrs:{href:"https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fdarius%2FrequestAnimationFrame",target:"_blank",rel:"noopener noreferrer"}},[t._v("requestAnimationFrame"),a("OutboundLink")],1)])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("now")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'use strict'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" vendors "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webkit'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'moz'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" vendors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("requestAnimationFrame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" vp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vendors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("requestAnimationFrame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("vp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'RequestAnimationFrame'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cancelAnimationFrame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("vp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CancelAnimationFrame'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("vp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CancelRequestAnimationFrame'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("iP(ad|hone|od).*OS 6")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userAgent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// iOS6 is buggy")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("requestAnimationFrame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cancelAnimationFrame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" lastTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("requestAnimationFrame")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" now "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" nextTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("max")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lastTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" now"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lastTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                              nextTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" now"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cancelAnimationFrame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" clearTimeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"_8-页面加载执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-页面加载执行"}},[t._v("#")]),t._v(" 8 页面加载执行")]),t._v(" "),a("h3",{attrs:{id:"_8-1-浏览器事件循环"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-浏览器事件循环"}},[t._v("#")]),t._v(" 8.1 浏览器事件循环")]),t._v(" "),a("blockquote",[a("p",[t._v("事件循环是指: 执行一个宏任务，然后执行清空微任务列表，循环再执行宏任务，再清微任务列表")])]),t._v(" "),a("ul",[a("li",[t._v("微任务 "),a("code",[t._v("microtask(jobs): promise / process.nextTick / MutationObserver")])]),t._v(" "),a("li",[t._v("宏任务 "),a("code",[t._v("macrotask(task): setTimout / setInterval / setImmediate / script / IO / UI Rendering")])])]),t._v(" "),a("blockquote",[a("p",[t._v("宏任务中包括了 "),a("code",[t._v("script")]),t._v(" ，浏览器会先执行一个宏任务，接下来有异步代码的话就先执行微任务")])]),t._v(" "),a("h3",{attrs:{id:"_8-2-怎么判断页面是否加载完成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-怎么判断页面是否加载完成"}},[t._v("#")]),t._v(" 8.2 怎么判断页面是否加载完成")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Load")]),t._v(" 事件触发代表页面中的 "),a("code",[t._v("DOM")]),t._v("，"),a("code",[t._v("CSS")]),t._v("，"),a("code",[t._v("JS")]),t._v("，图片已经全部加载完毕。")]),t._v(" "),a("li",[a("code",[t._v("DOMContentLoaded")]),t._v(" 事件触发代表初始的 "),a("code",[t._v("HTML")]),t._v(" 被完全加载和解析，不需要等待 "),a("code",[t._v("CSS")]),t._v("，"),a("code",[t._v("JS")]),t._v("，图片加载")])]),t._v(" "),a("h3",{attrs:{id:"_8-3-css-加载会造成阻塞吗"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-css-加载会造成阻塞吗"}},[t._v("#")]),t._v(" 8.3 css 加载会造成阻塞吗 ？")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("DOM")]),t._v(" 和 "),a("code",[t._v("CSSOM")]),t._v(" 通常是并行构建的,所以 CSS 加载不会阻塞 DOM 的解析。")]),t._v(" "),a("li",[t._v("然而,由于 "),a("code",[t._v("Render Tree")]),t._v(" 是依赖于 DOM Tree 和 "),a("code",[t._v("CSSOM Tree")]),t._v(" 的,")]),t._v(" "),a("li",[t._v("所以他必须等待到 "),a("code",[t._v("CSSOM Tree")]),t._v(" 构建完成,也就是 CSS 资源加载完成(或者 CSS 资源加载失败)后,才能开始渲染。")]),t._v(" "),a("li",[t._v("因此,CSS 加载会阻塞 Dom 的渲染。")]),t._v(" "),a("li",[t._v("由于 JavaScript 是可操纵 DOM 和 css 样式的,如果在修改这些元素属性同时渲染界面（即 JavaScript 线程和 UI线程同时运行）,那么渲染线程前后获得的元素数据就可能不一致了。")]),t._v(" "),a("li",[t._v("因此为了防止渲染出现不可预期的结果,浏览器设置 GUI 渲染线程与 JavaScript 引擎为互斥的关系。因此,样式表会在后面的 js 执行前先加载执行完毕,所以css 会阻塞后面 js 的执行")])]),t._v(" "),a("h3",{attrs:{id:"_8-4-为什么-js-阻塞页面加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-为什么-js-阻塞页面加载"}},[t._v("#")]),t._v(" 8.4 为什么 JS 阻塞页面加载 ?")]),t._v(" "),a("ul",[a("li",[t._v("由于 JavaScript 是可操纵 DOM 的,如果在修改这些元素属性同时渲染界面（即 JavaScript 线程和 UI 线程同时运行）,那么渲染线程前后获得的元素数据就可能不一致了")]),t._v(" "),a("li",[t._v("因此为了防止渲染出现不可预期的结果,浏览器设置 GUI 渲染线程与 JavaScript 引擎为互斥的关系")]),t._v(" "),a("li",[t._v("当 JavaScript 引擎执行时 GUI 线程会被挂起,GUI 更新会被保存在一个队列中等到引擎线程空闲时立即被执行")]),t._v(" "),a("li",[t._v("从上面我们可以推理出,由于 GUI 渲染线程与 JavaScript 执行线程是互斥的关系,")]),t._v(" "),a("li",[t._v("当浏览器在执行 JavaScript 程序的时候,GUI 渲染线程会被保存在一个队列中,直到 JS 程序执行完成,才会接着执行")]),t._v(" "),a("li",[t._v("因此如果 JS执行的时间过长,这样就会造成页面的渲染不连贯,导致页面渲染加载阻塞的感觉")])]),t._v(" "),a("h3",{attrs:{id:"_8-5-domcontentloaded-与-load-的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-domcontentloaded-与-load-的区别"}},[t._v("#")]),t._v(" 8.5 DOMContentLoaded 与 load 的区别 ?")]),t._v(" "),a("ul",[a("li",[t._v("当 "),a("code",[t._v("DOMContentLoaded")]),t._v(" 事件触发时,仅当 "),a("code",[t._v("DOM")]),t._v(" 解析完成后,不包括样式表,图片。我们前面提到 CSS 加载会阻塞 Dom 的渲染和后面 js 的执行,js 会阻塞 Dom 解析,所以我们可以得到结论:")]),t._v(" "),a("li",[t._v("当文档中没有脚本时,浏览器解析完文档便能触发 "),a("code",[t._v("DOMContentLoaded")]),t._v(" 事件。如果文档中包含脚本,则脚本会阻塞文档的解析,而脚本需要等 CSSOM 构建完成才能执行。在任何情况下,"),a("code",[t._v("DOMContentLoaded")]),t._v(" 的触发不需要等待图片等其他资源加载完成")]),t._v(" "),a("li",[t._v("当 "),a("code",[t._v("onload")]),t._v(" 事件触发时,页面上所有的 "),a("code",[t._v("DOM")]),t._v(",样式表,脚本,图片等资源已经加载完毕")]),t._v(" "),a("li",[a("code",[t._v("DOMContentLoaded")]),t._v(" -> "),a("code",[t._v("load")])])]),t._v(" "),a("h3",{attrs:{id:"_8-6-什么是-crp-即关键渲染路径-如何优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-6-什么是-crp-即关键渲染路径-如何优化"}},[t._v("#")]),t._v(" 8.6 什么是 CRP,即关键渲染路径? 如何优化")]),t._v(" "),a("blockquote",[a("p",[t._v("关键渲染路径是浏览器将 HTML CSS JavaScript 转换为在屏幕上呈现的像素内容所经历的一系列步骤。也就是我们上面说的"),a("strong",[t._v("浏览器渲染流程")]),t._v("。")])]),t._v(" "),a("p",[t._v("为尽快完成首次渲染,我们需要最大限度减小以下三种可变因素:")]),t._v(" "),a("ul",[a("li",[t._v("关键资源的数量: 可能阻止网页首次渲染的资源。")]),t._v(" "),a("li",[t._v("关键路径长度: 获取所有关键资源所需的往返次数或总时间。")]),t._v(" "),a("li",[t._v("关键字节: 实现网页首次渲染所需的总字节数,等同于所有关键资源传送文件大小的总和")])]),t._v(" "),a("p",[a("strong",[t._v("1. 优化 DOM")])]),t._v(" "),a("ul",[a("li",[t._v("删除不必要的代码和注释包括空格,尽量做到最小化文件。")]),t._v(" "),a("li",[t._v("可以利用 GZIP 压缩文件。")]),t._v(" "),a("li",[t._v("结合 HTTP 缓存文件")])]),t._v(" "),a("p",[a("strong",[t._v("2. 优化 CSSOM")])]),t._v(" "),a("blockquote",[a("p",[t._v("缩小、压缩以及缓存同样重要,对于 CSSOM 我们前面重点提过了它会阻止页面呈现,因此我们可以从这方面考虑去优化。")])]),t._v(" "),a("ul",[a("li",[t._v("减少关键 CSS 元素数量")]),t._v(" "),a("li",[t._v("当我们声明样式表时,请密切关注媒体查询的类型,它们极大地影响了 CRP 的性能")])]),t._v(" "),a("p",[a("strong",[t._v("3. 优化 JavaScript")])]),t._v(" "),a("blockquote",[a("p",[t._v("当浏览器遇到 script标记时,会阻止解析器继续操作,直到 CSSOM 构建完毕,JavaScript 才会运行并继续完成 DOM 构建过程。")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("async")]),t._v(": 当我们在 "),a("code",[t._v("script")]),t._v(" 标记添加 "),a("code",[t._v("async")]),t._v(" 属性以后,浏览器遇到这个 "),a("code",[t._v("script")]),t._v(" 标记时会继续解析 DOM,同时脚本也不会被 "),a("code",[t._v("CSSOM")]),t._v(" 阻止,即不会阻止 "),a("code",[t._v("CRP")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("defer")]),t._v(": 与 "),a("code",[t._v("async")]),t._v(" 的区别在于,脚本需要等到文档解析后（ "),a("code",[t._v("DOMContentLoaded")]),t._v(" 事件前）执行,而 "),a("code",[t._v("async")]),t._v(" 允许脚本在文档解析时位于后台运行（两者下载的过程不会阻塞 "),a("code",[t._v("DOM")]),t._v(",但执行会）")]),t._v(" "),a("li",[t._v("当我们的脚本不会修改 "),a("code",[t._v("DOM")]),t._v(" 或 "),a("code",[t._v("CSSOM")]),t._v(" 时,推荐使用 async")]),t._v(" "),a("li",[t._v("预加载 —— "),a("code",[t._v("preload & prefetch")])]),t._v(" "),a("li",[a("code",[t._v("DNS")]),t._v(" 预解析 —— "),a("code",[t._v("dns-prefetch")])])]),t._v(" "),a("p",[a("strong",[t._v("总结")])]),t._v(" "),a("ul",[a("li",[t._v("分析并用 关键资源数 关键字节数 关键路径长度 来描述我们的 "),a("code",[t._v("CRP")])]),t._v(" "),a("li",[t._v("最小化关键资源数:消除它们（内联）、推迟它们的下载（"),a("code",[t._v("defer")]),t._v("）或者使它们异步解析（"),a("code",[t._v("async")]),t._v("）等")]),t._v(" "),a("li",[t._v("优化关键字节数（缩小、压缩）来减少下载时间\n优化加载剩余关键资源的顺序:")]),t._v(" "),a("li",[t._v("让关键资源（"),a("code",[t._v("CSS")]),t._v("）尽早下载以减少 "),a("code",[t._v("CRP")]),t._v(" 长度")])]),t._v(" "),a("h2",{attrs:{id:"_9-history路由和hash路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-history路由和hash路由"}},[t._v("#")]),t._v(" 9 history路由和hash路由")]),t._v(" "),a("p",[a("strong",[t._v("hash 路由")])]),t._v(" "),a("blockquote",[a("p",[t._v("hash 路由，在 html5 前，为了解决单页路由跳转问题采用的方案， hash 的变化不会触发页面渲染，服务端也无法获取到 hash 值，前端可通过监听 hashchange 事件来处理hash值的变化")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("window.addEventListener('hashchange', function(){ \n    // 监听hash变化，点击浏览器的前进后退会触发\n})\n")])])]),a("p",[a("strong",[t._v("history 路由")])]),t._v(" "),a("blockquote",[a("p",[t._v("history 路由，是 html5 的规范，提供了对"),a("code",[t._v("history")]),t._v("栈中内容的操作，常用api有：")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("history"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pushState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// let currentState = history.state; 获取当前state")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// state：需要保存的数据，这个数据在触发popstate事件时，可以在event.state里获取")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// title：标题，基本没用，一般传 null")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// url：设定新的历史记录的 url。新的 url 与当前 url 的 origin 必须是一樣的，否则会抛出错误。url可以是绝对路径，也可以是相对路径。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如 当前url是 https://www.baidu.com/a/,执行history.pushState(null, null, './qq/')，则变成 https://www.baidu.com/a/qq/，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//执行history.pushState(null, null, '/qq/')，则变成 https://www.baidu.com/qq/")]),t._v("\n\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("history"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("replaceState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 与 pushState 基本相同，但她是修改当前历史记录，而 pushState 是创建新的历史记录")]),t._v("\n\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"popstate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听浏览器前进后退事件，pushState 与 replaceState 方法不会触发              ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"_10-performance相关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-performance相关"}},[t._v("#")]),t._v(" 10 performance相关")]),t._v(" "),a("h3",{attrs:{id:"window-performance-getentries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#window-performance-getentries"}},[t._v("#")]),t._v(" window.performance.getEntries()")]),t._v(" "),a("blockquote",[a("p",[t._v("浏览器获取网页时，会对网页中每一个对象（脚本文件、样式表、图片文件等等）发出一个HTTP请求。而通过"),a("code",[t._v("window.performance.getEntries")]),t._v("方法，则可以以数组形式，返回这些请求的时间统计信息，每个数组成员均是一个"),a("code",[t._v("PerformanceResourceTiming")]),t._v("对象！")])]),t._v(" "),a("p",[t._v("用它小玩儿一下，统计页面上的静态资源加载耗时：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 浏览器不支持，就算了！")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("performance "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getEntries"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取当前页面所有请求对应的PerformanceResourceTiming对象进行分析")]),t._v("\n    window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("perf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'url'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" perf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'entryType'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" perf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("entryType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" perf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("initiatorType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'duration(ms)'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" perf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("duration\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 控制台输出统计结果")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://s.poetries.top/images/20210329140157.png",loading:"lazy"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);